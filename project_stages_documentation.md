# AI 寶可夢短篇小說產生器：專案階段說明

本文件旨在說明「AI 寶可夢短篇小說產生器」目前的開發階段與核心運作流程，特別是思維鏈 (Chain of Thought, CoT) 技術的應用。

## 一、整體流程概覽

目前的系統主要透過以下幾個階段，引導使用者與 AI 協同創作寶可夢短篇故事：

1.  **使用者輸入故事素材**：使用者提供創作故事所需的基本元素。
2.  **(可選) 獲取寫作提示**：AI 針對使用者的初步輸入，提供改進建議。
3.  **AI 生成初步故事大綱**：AI 根據使用者輸入，生成一個結構化的故事大綱。
4.  **使用者檢視與編輯大綱**：使用者可以修改 AI 生成的大綱，使其更符合個人想法。
5.  **AI 根據最終大綱生成完整故事**：AI 遵循（可能是使用者編輯過的）大綱，創作成品故事。
6.  **(可選) 下載成果**：使用者可以下載生成的故事大綱與完整故事。

## 二、各階段詳細說明

### 階段 1：使用者輸入故事素材

此階段是整個創作流程的起點。使用者需要在介面上提供以下資訊：

*   **故事主題 (必填)**：例如「意外的友誼」、「神秘的發現」。
*   **故事類型 (必填)**：從下拉選單中選擇，例如「冒險 (Adventure)」、「喜劇 (Comedy)」、「科幻 (Sci-Fi)」等。此選項會影響 AI 生成內容的風格和側重點。
*   **登場寶可夢 (必填，逗號分隔)**：例如「皮卡丘, 伊布, 噴火龍」。AI 會嘗試將這些寶可夢自然地融入故事。
*   **故事概要範例 (可選)**：為方便使用者，介面提供了數個「故事概要範例」按鈕，這些按鈕位於「故事概要 / 想法」輸入框的上方。點擊任一範例按鈕，不僅會將預設的概要填入下方的「故事概要 / 想法」輸入框，還會自動將與該範例對應的「故事主題」填入上方的「故事主題」輸入框中。
*   **故事概要 / 想法 (必填)**：使用者對故事情節的基本構想。
*   **在故事中加入寶可夢的特性/能力 (可選，勾選)**：若勾選，AI 會嘗試在故事中更明確地展現所選寶可夢的已知特性或獨特能力。

**語言風格與長度預期：**
所有 AI 生成的內容（包含寫作提示、大綱、完整故事）都會被指示使用**繁體中文（台灣常用風格）**。
目前系統設定的目標是生成約 **1000-1500 字**的完整故事。

### 階段 2：(可選) 獲取寫作提示

在填寫完初步素材後，使用者可以點擊「💡 獲取寫作提示」按鈕。此階段旨在協助使用者深化故事情節，並提供更明確的創作方向。

*   **執行者**：`CoTEngine.get_input_refinement_suggestions()` (使用 `gpt 4.1 mini` 模型)
*   **CoT 應用**：此功能體現了「問題分解與澄清」的 CoT 思想。
    *   AI (`gpt 4.1 mini`) 會分析使用者當前的輸入（包含主題、類型、寶可夢、概要、是否加入特性），並使用 `INPUT_REFINEMENT_SUGGESTION_PROMPT_TEMPLATE` 提示模板，生成 1-2 條具體的、個人化的建議或引導性問題。
    *   **提示內容調整**：AI 的提問將避免詢問寶可夢「特性是什麼」這類可輕易查閱的資訊。取而代之的是，提示會引導使用者思考「故事希望如何運用或聚焦於該寶可夢特性的特定面向」。例如，AI 可能會問：「您希望皮卡丘的『靜電』特性在故事中是引發一連串趣味誤會的起點，還是成為解救夥伴於危難之中的關鍵能力？」或者「對於噴火龍的『猛火』特性，您是想描寫它在絕境中爆發的強大威力，還是它因此帶來的某種內心掙扎或成長？」
*   **目的**：旨在引導使用者提供更豐富、更具體的細節，釐清故事中寶可夢特性的展現方式，從而優化後續 CoT 主流程的起點，提升最終故事的品質與深度。
*   **輸出**：
    *   **AI 生成的個人化提示**：顯示在「寫作建議」區塊的文字提示。
    *   **範例提示**：除了 AI 生成的提示外，系統還會提供數個預設的「提示範例」（例如：「試著思考主角寶可夢遇到最大的挑戰會是什麼？」、「這個故事的高潮之後，角色的心境會有什麼轉變？」）。這些範例會以按鈕或列表的形式呈現，使用者可以點擊選用，將其內容填入相關輸入框，或作為激發更多想法的參考。

### 階段 3：AI 生成初步故事大綱

當使用者填寫完必要的素材後，可以點擊「📝 產生故事大綱」按鈕。

*   **執行者**：`CoTEngine.generate_story_plan()` (內部呼叫 `_generate_story_plan`, 使用 `gpt 4.1 mini` 模型)
*   **CoT 應用 (核心階段一：規劃與結構化思考)**：
    *   AI (`gpt 4.1 mini`) 會使用 `STORY_PLANNING_PROMPT_TEMPLATE` 提示模板。
    *   此提示會指示 AI 扮演寶可夢故事大師，根據使用者提供的所有輸入（主題、類型、寶可夢、概要、是否加入特性），創建一個結構化的故事大綱。
    *   大綱被要求包含清晰的結構，如：引言、觸發事件、發展（Rising Action）、高潮、收尾（Falling Action）、結局。
    *   AI 被指示要考慮故事類型，並在計劃中為寶可夢特性（如果選擇加入）的展現預留空間。
    *   此階段的目標是生成一個足以支撐 1000-1500 字故事的詳細計劃。
*   **LLM 參數 (`gpt 4.1 mini`)**：呼叫 LLM 時，`max_tokens` 設定為 `1536`，以獲取較為詳盡的大綱。
*   **輸出**：生成的故事大綱會顯示在一個**可編輯**的文本框 (`output_story_plan`) 中。同時，狀態訊息會提示使用者大綱已生成。

### 階段 4：使用者檢視與編輯大綱

這是系統賦予使用者主動權的關鍵互動階段。

*   使用者可以直接在介面上「產生的故事大綱 (您可以在此編輯)」文本框中，修改 AI 生成的初步大綱。
*   可以調整情節順序、增刪內容、修改細節，使其更貼合個人創意。

### 階段 5：AI 根據最終大綱生成完整故事

當使用者對故事大綱感到滿意（無論是否進行過編輯）後，可以點擊「📜 從上方大綱產生完整故事」按鈕。

*   **執行者**：`CoTEngine.generate_story_from_plan()` (內部呼叫 `_generate_story_from_plan`, 使用 `gpt 4.1 mini` 模型)
*   **CoT 應用 (核心階段二：遵循既定思路擴展與潤色)**：
    *   AI (`gpt 4.1 mini`) 會使用 `STORY_GENERATION_FROM_PLAN_PROMPT_TEMPLATE` 提示模板。
    *   此提示會指示 AI 根據**使用者最終確認（可能已編輯）的故事大綱** (`edited_story_plan`) 以及所有原始輸入（主題、類型、寶可夢、概要、是否加入特性）作為上下文，創作一篇完整的短篇故事。 **特別強調，AI 應致力於生成段落內容充實、敘事連貫的文字，每個段落應包含多個句子，並充分闡述大綱中對應的情節點，避免過於簡短或零碎的段落。AI 需要在段落中加入豐富的細節描寫、角色情感和場景氛圍，以提升故事的沉浸感和文學性。** AI 被要求嚴格遵循大綱的結構和內容，同時確保故事的流暢性、文筆的吸引力，並融入指定的類型風格和寶可夢特性（如果選擇）。
    *   目標字數約為 1000-1500 字。
*   **LLM 參數 (`gpt 4.1 mini`)**：呼叫 LLM 時，`max_tokens` 設定為 `4096`，以允許生成較長的文本；`temperature` 設定為 `0.75` 以平衡創意與一致性。
*   **輸出**：生成的完整故事會顯示在「產生的完整故事」Markdown 區塊 (`output_full_story`)。狀態訊息會提示故事已完成。

### 階段 6：(可選) 下載成果

為了方便使用者保存和進一步使用生成的內容，系統提供了下載功能：

*   **下載故事大綱**：點擊「📥 下載故事大綱 (.txt)」按鈕，可以將「故事大綱」文本框中的內容下載為 `.txt` 檔案。
    *   **執行者**：`handle_download_text_as_file()` 函式。
*   **下載完整故事**：點擊「📥 下載完整故事 (.txt)」按鈕，可以將「完整故事」區塊的內容（Markdown 格式）下載為 `.txt` 檔案。
    *   **執行者**：`handle_download_text_as_file()` 函式。

## 三、未來可能的擴展方向

*   **分階段生成寫作提示**：將「獲取寫作提示」功能進一步細化，允許使用者針對不同方面（如角色、情節、背景）逐步獲取更深入的提示。
*   **分階段生成完整故事**：將「從大綱生成完整故事」的過程也拆分成更小的、可互動的步驟（例如逐段生成，並允許使用者在每段生成後預覽、甚至微調）。

---

希望這份說明能幫助您更好地理解目前的專案架構！ 